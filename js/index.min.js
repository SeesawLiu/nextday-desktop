function getDate(e){var t,a=moment().get("month")+1,n=moment().get("date");switch(10>a&&(a="0"+a),10>n&&(n="0"+n),e){case"json":return t=moment().get("year")+"/"+a+"/"+n;case"image":return t=""+moment().get("year")+a+n;default:console.log("Error:Date Argument Not Found!")}}function getjsonDate(){return dateType="json",out=getDate(dateType)}function getimgDate(){return dateType="image",out=getDate(dateType)}function getmonth(){var e=new Array(12);return e[0]="JAN",e[1]="FEB",e[2]="MAR",e[3]="APR",e[4]="MAY",e[5]="JUN",e[6]="JUL",e[7]="AUG",e[8]="SEP",e[9]="OCT",e[10]="NOV",e[11]="DEC",e[moment().get("month")]}function getweekday(){var e=new Array(7);return e[0]="SUNDAY",e[1]="MONDAY",e[2]="TUESDAY",e[3]="WEDNESDAY",e[4]="THURSDAY",e[5]="FRIDAY",e[6]="SATURDAY",e[moment().get("day")]}function getday(){var e=moment().get("date");return 10>e&&(e="0"+e),""+e}function getinfo(){nodegrass.get("http://nichijou.in/LastDay/"+pulldate+".json",function(e){function t(){setTimeout("$('#startup').fadeOut()",3e3)}if(recvjsondata=JSON.parse(e),pic=recvjsondata[imgdate].images.big568h2x.replace("{img}","http://nextday-pic.b0.upaiyun.com"),recvjsondata[imgdate].geo)geo=recvjsondata[imgdate].geo.reverse;else{var a=new RegExp("^[^.]+","g"),n=recvjsondata[imgdate].text.comment2;geo=a.exec(n)}if(geo=geo.replace(",",", "),recvjsondata[imgdate].text["short"])text_short=recvjsondata[imgdate].text["short"].replace(/,/g,", ");else{var o=new RegExp("[^.]+$","g"),n=recvjsondata[imgdate].text.comment2;text_short=recvjsondata[imgdate].text.comment1+","+o.exec(n),text_short=text_short.replace(/,/g,", ")}color_back=recvjsondata[imgdate].colors.background,recvjsondata[imgdate].music?(recvjsondata[imgdate].music.url?(musicurl=recvjsondata[imgdate].music.url.replace("{music}","http://nextday-file.b0.upaiyun.com/"),$("#todaymusic").attr("src",musicurl)):(nitingcode=recvjsondata[imgdate].music.nitingCode,nodegrass.get("http://www.niting.com/iphone.do?method=getMusicUrlByCode&musiccode="+nitingcode,function(e){recvmusicdata=e,recvmusicdata=JSON.parse(recvmusicdata),musicurl=recvmusicdata.object.dc_musicurl,$("#todaymusic").attr("src",musicurl)},null,"utf8")),musicname=recvjsondata[imgdate].music.name,musicartist=recvjsondata[imgdate].music.artist):(musicname="There is no music here.",musicartist=""),mawae=recvjsondata[imgdate].event?getmonth()+". "+getweekday()+", "+recvjsondata[imgdate].event:getmonth()+". "+getweekday(),recvjsondata[imgdate].author&&(author="&copy;"+recvjsondata[imgdate].author.name),$("#background").css("background-color",color_back),$("#mawae").html(mawae),$("#day").html(getday()),$("#geo").html(geo),$("#short").html(text_short),$("#songname").html(musicname),$("#artist").html(musicartist),$("#cover").css("background-image","url('"+pic+"')"),$("#author").html(author),t()},null,"utf8")}function getupdate(){fs.readFile("./package.json",{encoding:"utf8",flag:"r"},function(e,t){if(e)throw e;var a=JSON.parse(t),n=a.version;nodegrass.get("http://nd.nichijou.in/latestversion",function(e){n==e?console.log("Up to date"):alert("有新版本！请到官网下载\n目前版本:"+n+"\n最新版本:"+e)},null,"utf8")})}var nodegrass=require("nodegrass"),moment=require("moment"),gui=require("nw.gui"),win=gui.Window.get(),fs=require("fs"),recvjsondata="",recvmusicdata="",pulldate="",imgdate="",pic="",text_short="",color_back="",bigpicurl2x="",mawae="",author="",musicurl="",musicname="",musicartist="",nitingcode="",dateType="";win.setResizable(0),$(document).ready(function(){pulldate=getjsonDate(),imgdate=getimgDate(),$("#page").mouseenter(function(){$("#winctrl").fadeIn(),"none"===$("#timemachine").css("display")&&$("#tmopen").fadeIn()}),$("#page").mouseleave(function(){$("#winctrl").fadeOut(),"none"===$("#timemachine").css("display")&&$("#tmopen").fadeOut()}),$("#min").click(function(){win.minimize()}),$("#exit").click(function(){win.close()}),$("#play-pause-button").click(function(){$("#todaymusic")[0].paused?($("#play-pause-button").removeClass("play").addClass("pause"),$("#todaymusic").trigger("play")):($("#play-pause-button").removeClass("pause").addClass("play"),$("#todaymusic").trigger("pause"))}),$("#todaymusic").bind("ended",function(){$("#play-pause-button").removeClass("pause").addClass("play")}),getupdate(),getinfo()}),win.on("close",function(){$("#exitpage").fadeIn(),$("#slogan").trigger("play"),$("#slogan").bind("ended",function(){win.close(!0)})});